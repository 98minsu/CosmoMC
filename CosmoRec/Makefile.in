#===============================================================================
# choose c++ compiler
#===============================================================================
CC= g++

#===============================================================================
# compiler flags
#===============================================================================
CXXFLAGS = -Wall -pedantic -O2
#CXXFLAGS = -Wall -pedantic -pg

#===============================================================================
# linker flags
#===============================================================================
LXXFLAGS =
#LXXFLAGS = -pg

#===============================================================================
# GSL lib
#===============================================================================
GSL = gsl
GSL_INC_PATH = /usr/local/include/
GSL_LIB_PATH = /usr/local/lib/

#===============================================================================
#===============================================================================
#===============================================================================
#
# below normally no changes should be necessary...
#
#===============================================================================
#===============================================================================
#===============================================================================


#===============================================================================
# directory Development-libs
#===============================================================================
DEV_DIR = ./Development
REC_BASE= ./Rec_database

#===============================================================================
# passing the CosmoRec path on to the compiler
#===============================================================================
CXXFLAGSLOC = $(CXXFLAGS) \
              -D COSMORECPATH=\"$(PWD)/\" \
              -D COSMOREC_BASE_PATH=\"$(REC_BASE)/\"

#===============================================================================
# Required external libs
#===============================================================================
GSL_LIB = $(GSL_LIB_PATH)/lib$(GSL).a
LIB_GSL = $(GSL)
LIBSGSL= -L$(GSL_LIB_PATH) -l$(LIB_GSL)
LIBS    = $(LIBSGSL) -lm -lgslcblas

#===============================================================================
# Recfast++ object files
#===============================================================================
OBJSRecfast++ = $(DEV_DIR)/Cosmology/Recfast++/src/recombination.Recfast.o \
		$(DEV_DIR)/Cosmology/Recfast++/src/ODE_solver.Recfast.o \
		$(DEV_DIR)/Cosmology/Recfast++/src/cosmology.Recfast.o \
		$(DEV_DIR)/Cosmology/Recfast++/src/evalode.Recfast.o \
		$(DEV_DIR)/Cosmology/Recfast++/src/DM_annihilation.Recfast.o \
		$(DEV_DIR)/Cosmology/Recfast++/src/Rec_corrs_CT.Recfast.o

#===============================================================================
# object files
#===============================================================================
OBJSDEV =  $(DEV_DIR)/Simple_routines/File.o \
	   $(DEV_DIR)/Simple_routines/routines.o \
	   $(DEV_DIR)/Cosmology/Cosmos.o $(OBJSRecfast++) \
	   $(DEV_DIR)/Integration/Patterson.o \
	   $(DEV_DIR)/Integration/Integration_routines.GSL.o \
	   $(DEV_DIR)/Integration/Chebyshev_Int.o \
           $(DEV_DIR)/ODE_PDE_Solver/ODE_solver_Rec.o \
	   $(DEV_DIR)/ODE_PDE_Solver/PDE_solver.o \
	   $(DEV_DIR)/Line_profiles/Voigtprofiles.o \
	   $(DEV_DIR)/Line_profiles/two_photon_profile.2s1s.o \
	   $(DEV_DIR)/Line_profiles/HI_matrix_elements.o \
	   $(DEV_DIR)/Line_profiles/Raman_profiles.o \
	   $(DEV_DIR)/Line_profiles/nsnd_2gamma_profiles.o \
	   $(DEV_DIR)/Line_profiles/HI_Transition_Data.o \
	   $(DEV_DIR)/Hydrogenic/Oscillator_strength.o \
	   $(DEV_DIR)/Hydrogenic/Photoionization_cross_section.o \
	   $(DEV_DIR)/Hydrogenic/Rec_Phot_BB.o \
	   $(DEV_DIR)/Hydrogenic/Atom.o \
	   $(DEV_DIR)/Hydrogenic/Recombination_Integrals.o \
	   $(DEV_DIR)/Helium/HeI_Atom.o \
	   $(DEV_DIR)/Recombination/Sobolev.o \
	   $(DEV_DIR)/Recombination/Pesc.HI.o \
	   $(DEV_DIR)/Recombination/ODE_effective.o \
	   $(DEV_DIR)/Recombination/ODEdef_Xi.HeI.o

#===============================================================================
# object files
#===============================================================================
OBJSRAMAN = ./PDE_Problem/define_PDE.o \
	    ./PDE_Problem/Solve_PDEs.o \
	    ./PDE_Problem/HI_pd_Rp_splines_effective.o \
	    ./PDE_Problem/Load.Populations.HI.o 

OBJSDATA = $(REC_BASE)/Effective_Rates.HI/get_effective_rates.HI.o \
           $(REC_BASE)/Effective_Rates.HeI/get_effective_rates.HeI.o

OBJS=$(OBJSDEV) $(OBJSRAMAN) $(OBJSDATA)

#===============================================================================
# program 
#===============================================================================

all: Recfast++ CosmoRec CosmoReclib

lib: CosmoReclib

bin: Recfast++ CosmoRec

CosmoRec:  $(OBJS) CosmoRec.o main.o
	   @echo " Linking CosmoRec binary"
	   $(CC) $(LXXFLAGS) $(OBJS) CosmoRec.o main.o $(LIBS) -o CosmoRec

CosmoReclib: $(OBJS) CosmoRec.o
	     @echo " Creating ComsoRec library"
	     ar rvs ./libCosmoRec.a $?

Recfast++: 
	cd $(DEV_DIR)/Cosmology/Recfast++; make;

#===============================================================================
# rules
#===============================================================================

INC_PATH = -I$(DEV_DIR)/Definitions -I$(DEV_DIR)/Recombination \
	   -I$(DEV_DIR)/Integration -I$(DEV_DIR)/Cosmology \
	   -I$(DEV_DIR)/Cosmology/Recfast++/include \
	   -I$(DEV_DIR)/Hydrogenic -I$(DEV_DIR)/Line_profiles \
	   -I$(DEV_DIR)/Helium -I$(DEV_DIR)/Simple_routines \
	   -I$(DEV_DIR)/ODE_PDE_Solver -I./PDE_Problem \
	   -I$(REC_BASE)/Effective_Rates.HI \
	   -I$(REC_BASE)/Effective_Rates.HeI \
	   -I$(GSL_INC_PATH) -I.

.cpp.o:
	@echo "Producing object-file $@"
	$(CC) $(CXXFLAGSLOC) $(INC_PATH) -c $< -o $@
