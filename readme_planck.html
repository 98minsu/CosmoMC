<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <title>PlanckCosmomc ReadMe</title>
</head>
<body bgcolor="#FFFFFF" link="#0000FF" vlink="#800080">

<center>
<IMG SRC="http://cosmologist.info/cosmomc/pics/planck/Planck_WMAP.png">
<h2>CosmoMC and GetDist with Planck Likelihood and Chains</h2>

</center>
The Planck likelihood code (PLC/clik) and parameter chains are available from the <A HREF="http://wiki.cosmos.esa.int/planckpla/index.php/">Planck Legacy Archive</A>. The lensing and Bicep-Keck-Planck likelihoods are included with the cosmomc installation and do not need to be installed separately.
<P>
<H3>Using the Planck likelihood with CosmoMC</H3>
Here I assume you have installed CosmoMC in a directory called COSMOMC..PATH, and will install the Planck likelihood code in a directory called PLC..PATH.
Note you need to use ifort 14 or higher to build CosmoMC, so make sure you have that configured before you start. (It may also work with gfortran svn trunk, but not gfortran 4.9.)
<UL>
<LI>Download and and install the likelihood code and data files to somewhere convenient, probably not under cosmomc. These are the links (note things are likely to be updated and change, so apologies if not everything work exactly as stated here)
<UL>
<LI><A HREF="http://wiki.cosmos.esa.int/planckpla/index.php/CMB_spectrum_%26_Likelihood_Code">Planck likelihood code and data download links</A>
</UL>

<LI>Change to the plc_2.0  directory and do
<pre>bzip2 -d plc-2.0.tar.bz2; tar -xf plc-2.0.tar</pre>
<LI><pre>cd plc-2.0</pre>
<LI><pre>./waf configure --lapack_mkl=${MKLROOT} --lapack_mkl_version=10.3 --install_all_deps</pre>
  (you may need to change the options on this line depending on your installation; --install_all_deps may not be needed; see the .pdf document file in PLC..PATH/plc_2.0/plc_2.0 for options)
<LI><pre>./waf install</pre>
<LI>Edit your ~/.bashrc file to include
<pre>
export PLANCKLIKE=cliklike
export CLIKPATH=PLC..PATH/plc_2.0/plc_2.0
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CLIKPATH/lib
</pre>
Instead of the last item you can also use PLC's recommended <b>source PLC..PATH/plc_1.0/bin/clik_profile.sh</b>.
While you're at it you can add CosmoMC's python path (for plotting and quite analysis of chains):
<pre>
export PYTHONPATH=COSMOMC..PATH/python:$PYTHONPATH
</pre>
<LI>Change to your COSMOMC..PATH root directory and make a symbolic link to your PLC installation
<pre>
ln -s PLC..PATH/plc_1.0 ./data/clik
</pre>
(CosmoMC will look for files in ./data/clik - e.g. "ls -d ./data/clik/*.clik" should show you the likelihood data you downloaded).
<LI>Log out and in again to get the new settings,  then you can build cosmomc as described in the <A HREF="readme.html">ReadMe</A>.
</UL>
A set of .ini files are supplied in ./batch2 which set up standards for Planck runs. You can try
<pre>mpirun -np 2 ./cosmomc test.ini</pre>
to see if things are being loaded and start running OK.
<P>
<A NAME="PlanckChains"></A>
<H3>Using Planck Chains</H3>
Planck provide a set of parameter chains produced by CosmoMC, available <A HREF="http://wiki.cosmos.esa.int/planckpla/index.php/Cosmological_Parameters">here</a>. 
You can use CosmoMC's python scripts and getdist to analyse and make plots from them. First download and extract all the chain data. Make a symbolic link from ./cosmomc/PLA to the location of the chains, e.g.
<PRE>
ln -s /scratch/planck/PLA ./PLA
</PRE>
so that ./PLA/base is for example the head directory with the baseline model chains.
For the program to know about the structure of the grid you first need to initialize it for the location you have installed in. Do
<PRE>
python python/makeGrid.py PLA
</PRE>
You can now use the python/* scripts on the PLA directory, and they will know about the available data.
Grid configuration settings for the Planck parameter grid are in PLA/config/.
<H4>Calculating derived parameters</H4>
For simple calculations like finding the mean and variance of new derived parameters you can use the functions in python/chains.py. For example, if you want to calculate the posterior mean and limits for sigma8*Omegam^0.6 from Planck you could write a python script
<blockquote>
<pre>
import planckStyle as s

g = s.getSinglePlotter(chain_dir=r'./PLA')

samples = g.sampleAnalyser.samplesForRoot('base_plikHM_TT_lowTEB_lensing')

p = samples.getParams()

derived = p.sigma8 * p.omegam ** 0.6

print 'mean, err = ', samples.mean(derived), samples.std(derived)
print '95% limits: ', samples.twoTailLimits(derived, 0.95)
</pre>
</blockquote>
Here p.omegam is a vector of parameter values, similar p.sigma8; chains.mean and chains.var sum the samples with the corresponding weights to calculate the result.
<P>
See python/getdist/chains.py and python/getdist/MCSamples.py for other functions you can use.
 Use GetDist or MCSamples.py if you want to reproduce Planck results: chains.py only does tail integrals, it does not check for skewness or calculate credible intervals for skewed distributions. MCSamples gives you code access to most getdist results.
<H4>Plotting</H4>

You can also write your own short python scripts to plot things of interest; many examples are in <b>batch2/outputs/</b>.
Make sure you have set up your python/config.ini as described above with default file location.
 
For example you can do
<pre>
python batch2/outputs/pol_triangle.py
</pre>
to reproduce the figure above.
<P>
As an example python script not using planckStyle you can do
<blockquote>
<pre>
import GetDistPlots
g=GetDistPlots.GetDistPlotter('PLA/plot_data')
g.settings.setWithSubplotSize(4)

roots = ['base_nnu_mnu_planck_lowl_lowLike','base_nnu_mnu_planck_lowl_lowLike_highL','base_nnu_mnu_planck_lowl_lowLike_highL_post_BAO']
g.plot_2d(roots, param_pair=['mnu','nnu'], filled=True)
g.add_legend(['Planck+WP','Planck+WP+highL','Planck+WP+highL+BAO'],legend_loc='upper right');
g.export('mnu_nnu.png')
</pre>
</blockquote>
The legend overlaps a bit. You can do "import pylab *" and use standard matplotlib commands. Or you can try things like this
<blockquote>
<pre>
import GetDistPlots
g=GetDistPlots.GetDistPlotter('PLA/plot_data')
g.settings.setWithSubplotSize(4)
g.make_figure(xstretch=1.3)

roots = ['base_nnu_mnu_planck_lowl_lowLike','base_nnu_mnu_planck_lowl_lowLike_highL','base_nnu_mnu_planck_lowl_lowLike_highL_post_BAO']
g.plot_2d(roots, param_pair=['mnu','nnu'], filled=True)
g.add_legend(['Planck+WP','Planck+WP+highL','Planck+WP+highL+BAO'],legend_loc='upper right',colored_text=True);
g.export('mnu_nnu2.png')
</pre>
</blockquote>
Outputs of the two versions should look like this:<BR>
<IMG SRC="http://cosmologist.info/cosmomc/pics/planck/mnu_nnu.png">
<IMG SRC="http://cosmologist.info/cosmomc/pics/planck/mnu_nnu2.png">
<P>
 You can also use <B>python python/makePlots.py PLA  ..</B> to make plots en masse for quick inspection of grid results.
</body> 