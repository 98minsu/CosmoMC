<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <title>PlanckCosmomc ReadMe</title>
</head>
<body bgcolor="#FFFFFF" link="#0000FF" vlink="#800080">


<h2>Planck Cosmomc Readme </h2>
<h3>Compiling</h3>
As usual, but now requires ifort 13+ (or other compiler with more complete Fortran 2003 coverage; this does not include gfortran). 
See clik_install.txt for details of how to set up with clik (no need to edit makefile other than usual compiler options).
Set <b>highL = ../highL</b> to build direct ACT/SPT support (for use with PLANCKLIKE = cliklike_CamSpec). You can either use clik or other likelihoods directly in an interchangeable way, parameter definitions etc are the same.
<p>
<h3>Data files</h3>
A set of .ini files are supplied in ./batch1 which set up standard for Planck runs. Location of data files is set in CAMspec_ACTSPT_defaults, CAMspec_defaults depending on what you want to use. You can either edit these, or make symbolic links from ./data/clik to the relevant actual file locations depending on what you want to use (and ./data/highL and ./data/camspec if you want to run them outside clik).
<p>
Default settings for parameters in the baseline model are described in the P11 svn paper draft, and should be reflected in the batch1 ini files.
<h3>Running</h3>
As usual for example for quick tests, e.g. <b>mpirun -np 2 ./cosmomc test.ini</b> or <b>perl runMPI.pl test 4</b>.
<p>
The runMPI_HPCS.pl sample script also supports best-fit runs, using last parameter zero: e.g. if ini has action=2 then run <b>perl runMPI_HPCS batch1/ini 0</b>.
<p>
The <b>lmax_computed_cl</b> parameter is set up with defaults (hopefully) appropriate for the various data combinations (eg. in CAMspec_defaults.ini, CAMspec_ACTSPT_defaults.ini). The cmbtypes.f90 lmax is fixed, and set to a high value.
<p>
Clik is available <A HREF="http://hfilfi.planck.fr/index.php/PSAndLikelihood/TopClik">here</A>.
The non-clik highL code is included with cosmomcplanck in the ./highL. The data files are available on Magique 3 at <br>
<b>/home/ecalabrese/actse_sptkr_clean_lranges_fg_camspecmodel_v1/data</b>
<Br>
Non-clik CamSpec code is included in ./source, and data files are available from Steven.

<h2>Changes</h2>
By default CosmoMC now uses a fast-slow sampling method which works very well for Planck. See the <A HREF="http://hfilfi.planck.fr/index.php/WG/WG?action=download&upname=Dragging2.pdf">Wiki notes</A>.
<p>
See the <A HREF="readme.html#Version">readme</A> for code changes.

<h2>Grids of models</h2>
See the ./python directory for scripts (python 2.7+), most can be run without arguments to show a list of possible input parameters.
To start copy and edit settings_testchain.py appropriately. Then if you saved it as python/my_settings_file.py run
<blockquote>
<b>python python/makeGrid.py /scratch/.../Planckgrids/newdirectoryforbatch my_settings_file</b>
</blockquote>
In practice I usually make a symlink to the grid path for convenience, e.g. <b>ln -s /scratch/aml1005/newgrid main</b> from the cosmomcplanck folder, so ./main then reference the output grid directory. This directory is used as input to most of the other scripts. See <b>prepareFullPlanckGrids</b> for commands to make the Planck parameter grid configuration (one main grid, plus a few subgrids that are then merged in).
<P>
Use runbatch.py to submit all the ini files produced to the queue; makeGrid will tell you what to do.
You will also need to produce a runMPI_xxx script for your machine, runMPI_HPCS.pl works on Darwin in Cambridge and is the default.  For brevity you can make a symbolic link in the cosmomcplanck directory to the actual scratch location of the (large) batch results [ln -n /scratch/.../myscratch main].
<P>
Covmats for Planck are in planck_covmats folder, linked by default for grid runs.
<p>
Grid run scripts include:
<UL>
<LI>makeGrid.py: as descried above, for setting up a grid of models. Stores the information in a "pickle" file that can then be read by the other scripts for iterating over batch items.
    <LI>addGridBatch.py: if you run multiple grids, e.g. a standard one and a separate small one for some parameter for interest, they can be combined using addGridBatch.py. Also use if the main batch importance samples some data, but a few of the models need to be run separately as chains: the script automatically replaces importance sampled runs with full chain runs if there is an overlap.
<LI>batchJob.py: not a script, this just defines the objects and iterators used
<LI>checkConverge.py: for finding chains which are missing or have R-1 larger than a specified threshold
<LI>cleanup.py: for cleaning up files (e.g. before re-running a failed chain); can also just be used to list files for runs matching input parameters
<LI>extractDistFiles.py: for copying all files of a particular type from all the subdirectories in the grid, e.g. to extract all .covmat files, or all .pdf plots
<LI>makeCompare.py: to extract parameter constraints from .margestats files in the grid
<LI>makeTables.py: script for making latex (and hence PDF) tables from .margestats and .minimum files produced by grid runs.
<BR>To make file of comparison plots do something like
<pre>
 python python/makeTables.py main comp --compare planck_lowl planck_lowl_lowLike  planck_lowl_lowLike_highL --portrait
</pre>
<LI>runbatch.py: submit runs to a job submission script
<LI>runGridGetdist.py: make getdist .ini files, run getdist over grid of models, and generate plots by running matlab.
<LI>settings_xx.py: sample settings files for use with makeGrid.py
</UL>
Most scripts have standardized input parameters to restrict to subsets of grid items, e.g. filtering by importance sampling run, no importance sampling, or specific item name (pattern match).
<P>
Multi-purpose use and utility scripts include
<UL>
<LI>bestFitCAMB.py: for converting .minimum best-fit file to CAMB input .ini file (not all parameter combinations)
<LI>chains.py: under development, not used by anything else (could make base for python version of GetDist)
<LI>covcomb.py: for combining covariance matrices (thanks Steven!)
<LI>covscale.py: for modifying .covmat files if parameters are re-scaled
<LI>covMat.py: object for covariance matrix and reading .covmat
<LI>GetDistPlots.py: make pylab-matplotlib plots from getdist outputs (alternative to matlab,with some additional flexibility). Add ./python to your $PYTHONPATH to use this from scripts elsewhere (e.g. in batch1/specificplots).
<LI>iniFile.py: for reading and writing .ini files (does not support reading fully at the moment, but not needed as yet)
<LI>makePerfectForecastDataset.py: a simple old script for simulating perfect fake CMB datasets
<LI>paramNames.py: for reading paramNames files, and general objects for storing parameter info
<LI>ResultObjs.py: objects for getdist output results (.margestats) and .minimum files. Note is expects formats to be those produced by cosmomcplanck, not older versions.
<LI>runningJobs.py: shows full long job names for running jobs (may not be portable) with status
</UL>

<h2>Plots</h2>
The runGridGetdist.py script will produce standard sets of getdist plots automatically for all runs. These can be customized in parameter-variation-specific way by adding additional getdist .ini include files in batch1\plots. Further completely general plots with custom scripts can be installed in batch1\specificplots. These are moving to python, using python/GetDistPlots.py.


</body></center> 