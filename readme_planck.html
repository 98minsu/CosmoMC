<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <title>PlanckCosmomc ReadMe</title>
</head>
<body bgcolor="#FFFFFF" link="#0000FF" vlink="#800080">


<h2>Planck Cosmomc Readme </h2>
<h3>Compiling</h3>
As usual. Edit the makefile, setting <b>PLANCKLIKE = cliklike</b> to run with clik (v5.0), or <b>PLANCKLIKE = cliklike_CamSpec</b> to run directly with CamSpec. Set <b>highL = ../highL</b> to build direct ACT/SPT support (for use with PLANCKLIKE = cliklike_CamSpec). To use clik you need of course to have clik installed, and set the CLIKPATH variable etc. appropriately.  You can either use clik or other likelihoods directly in an interchangeable way, parameter definitions etc are the same.
<p>
<h3>Data files</h3>
A set of .ini files are supplied in ./batch1 which set up standard for Planck runs. Location of data files is set in CAMspec_ACTSPT_defaults, CAMspec_defaults or PLik_ACTSPT_defaults depending on what you want to use. You can either edit these, or make symbolic links from ./data/clik and ./data/highL and ./data/camspec to the relevant actual file locations depending on what you want to use.
<p>
Default settings for parameters in the baseline model are described in the P11 svn paper draft, and should be reflected in the batch1 ini files.
<h3>Running</h3>
As usual, e.g. <b>perl runMPI.pl batch1/base 4</b>.
<p>
The runMPI_HPCS.pl sample script also supports best-fit runs, using last parameter zero: e.g. if ini has action=2 then run <b>perl runMPI_HPCS batch1/ini 0</b>.
<p>
The <b>lmax_computed_cl</b> parameter is set up with defaults (hopefully) appropriate for the various data combinations (eg. in CAMspec_defaults.ini, CAMspec_ACTSPT_defaults.ini). The cmbtypes.f90 lmax is fixed, and set to a high value.
<p>
For initial explorations you can use settings in batch1/fast_approx.ini.
<P>
Clik is available <A HREF="http://hfilfi.planck.fr/index.php/PSAndLikelihood/TopClik">here</A>.
The non-clik highL code is included with cosmomcplanck in the ./highL. The data files are available on Magique 3 at <br>
<b>/home/ecalabrese/actse_sptkr_clean_lranges_fg_camspecmodel_v1/data</b>
<Br>
Non-clik CamSpec code is included in ./source, and data files are available from Steven.

<h2>Changes</h2>
By default CosmoMC now uses a fast-slow sampling method which works very well for Planck. See the <A HREF="http://hfilfi.planck.fr/index.php/WG/WG?action=download&upname=Dragging2.pdf">Wiki notes</A>.
<p>
See the <A HREF="readme.html#Version">readme</A> for code changes.

<h2>Grids of models</h2>
See the ./python directory for scripts (python 2.7+), most can be run without arguments to show a list of possible input parameters.
To start copy and edit settings_testchain.py appropriately. Then if you saved it as python/my_settings_file.py run
<blockquote>
<b>python python/makeGrid.py /scratch/.../Planckgrids/newdirectoryforbatch my_settings_file [action]</b>
</blockquote>
Use runbatch.py to submit all the ini files produced to the queue. You will also need to produce a runMPI_xxx script for your machine, runMPI_HPCS.pl works on Darwin in Cambridge and is the default. Use action=2 to do minimization-only runs (quick), otherwise can be omitted.
<P>
Runs with the same data by default all use the same covmat unless an existing covmat exists in planck_covmats. Covmats can be a merged covmat that contains many parameters, defaults are provided from combining several different separate covmats for use where no planck_covmats file exists. Use the python/covcomb.py script if you want to make a new one.
<p>
Scripts include:
<UL>
<LI>makeGrid.py: as descried above, for setting up a grid of models. Stores the information in a "pickle" file that can then be read by the other scripts for iterating over batch items.
    <LI>addGridBatch.py: if you run multiple grids, e.g. a standard one and a separate small one for some parameter for interest, they can be combined using addGridBatch.py. Also use if the main batch importance samples some data, but a few of the models need to be run separately as chains: the script automatically replaces importance sampled runs with full chain runs if there is an overlap.
<LI>batchJob.py: not a script, this just defines the objects and iterators used
<LI>covcomb.py: for combining covariance matrices (thanks Steven!)
<LI>covscale.py: for modifying .covmat files if parameters are re-scaled
<LI>covMat.py: object for covariance matrix and reading .covmat
<LI>extractDistFiles.py: for copying all files of a particular type from all the subdirectories in the grid, e.g. to extract all .covmat files, or all .pdf plots
<LI>iniFile.py: for reading and writing .ini files (does not support reading fully at the moment, but not needed as yet)
<LI>makePerfectForecastDataset.py: a simple old script for simulating perfect fake CMB datasets
<LI>makeTables.py: script for making latex (and hence PDF) tables from .margestats and .minimum files produced by grid runs.
<LI>paramNames.py: for reading paramNames files, and general objects for storing parameter info
<LI>ResultObjs.py: objects for getdist output results (.margestats) and .minimum files. Note is expects formats to be those produced by cosmomcplanck, not older versions.
<LI>runBatch.py: submit runs to a job submission script
<LI>runGridGetdist.py: make getdist .ini files, run getdist over grid of models, and generate plots by running matlab.
</UL>
Many scripts have standardized input parameters to restrict to subsets of grid items, e.g. filtering by importance sampling run, no importance sampling, or specific item name (pattern match).

<h2>Plots</h2>
The runGridGetdist.py script will produce standard sets of getdist plots automatically for all runs. These can be customized in parameter-variation-specific way by adding additional getdist .ini include files in batch1\plots. Further completely general plots with custom matlab scripts can be installed in batch1\specificplots. These can use new matlab functions getdist_xxx provided in the mscripts directory (which must be added to your path if you want to run them directly in matlab; you can also set the getdist_plot_data environment variable so it knows where to look for getdist grid outputs; runGridGetdist sets up paths automatically).

<h2>To do</h2>

Lensing likelihood. Define consistent priors for nuisance parameters. Efficient use of fast highL nuisance parameters. Uncorrelated isocuvature? Figure out consistent way to handle mnu with non-standard nnu.



</body></center> 